<div class="titan-container" style="max-width: 1200px; margin: 0 auto; padding: 40px 20px;">

    <!-- Header -->
    <div style="text-align: center; margin-bottom: 60px;">
        <h1 class="hero-title crt-flicker" style="font-size: 3em; margin-bottom: 20px;">
            SYSTEM <span class="text-cyan">ARCHITECTURE</span>
        </h1>
        <p style="color: var(--text-secondary); max-width: 800px; margin: 0 auto; font-family: var(--font-mono);">
            DECLASSIFIED TECHNICAL SCHEMATICS // LEVEL 4 CLEARANCE REQUIRED
        </p>
    </div>

    <!-- System Flowchart Section -->
    <div class="titan-panel" style="padding: 40px; margin-bottom: 60px; overflow-x: auto;">
        <h2
            style="color: var(--neon-cyan); margin-bottom: 40px; border-bottom: 1px solid rgba(0, 255, 249, 0.2); padding-bottom: 10px;">
            // SYSTEM LOGIC SCHEMATIC
        </h2>

        <!-- Custom CSS Flowchart -->
        <div class="flow-container">

            <!-- Step 1: Input -->
            <div class="flow-node input-node">
                <div class="node-icon">üåê</div>
                <div class="node-title">USER INPUT</div>
                <div class="node-subtitle">URL Submission</div>
            </div>

            <div class="flow-arrow">‚ûú</div>

            <!-- Step 2: Orchestrator -->
            <div class="flow-node orch-node">
                <div class="node-icon">‚öôÔ∏è</div>
                <div class="node-title">ORCHESTRATOR</div>
                <div class="node-subtitle">Async Dispatch</div>
            </div>

            <div class="flow-arrow">‚ûú</div>

            <!-- Step 3: Parallel Layers -->
            <div class="layers-wrapper">

                <!-- Layer 1 -->
                <div class="layer-box l1">
                    <div class="layer-header">LAYER 1: STATIC</div>
                    <div class="sub-nodes">
                        <div class="mini-node">Syntax Check</div>
                        <div class="mini-node">Net Forensics</div>
                    </div>
                    <div class="layer-metric">
                        < 50ms</div>
                    </div>

                    <!-- Layer 2 -->
                    <div class="layer-box l2">
                        <div class="layer-header">LAYER 2: INTEL</div>
                        <div class="sub-nodes">
                            <div class="mini-node">Threat DBs</div>
                            <div class="mini-node">Cert Analysis</div>
                        </div>
                        <div class="layer-metric">
                            < 300ms</div>
                        </div>

                        <!-- Layer 3 -->
                        <div class="layer-box l3">
                            <div class="layer-header">LAYER 3: AI CORE</div>
                            <div class="sub-nodes">
                                <div class="mini-node">RAG Engine</div>
                                <div class="mini-node">Visual AI</div>
                                <div class="mini-node">ML Model</div>
                            </div>
                            <div class="layer-metric">~1s</div>
                        </div>
                    </div>

                    <div class="flow-arrow">‚ûú</div>

                    <!-- Step 4: Aggregation -->
                    <div class="flow-node agg-node">
                        <div class="node-icon">‚öñÔ∏è</div>
                        <div class="node-title">SCORING</div>
                        <div class="node-subtitle">Weighted Logic</div>
                    </div>

                    <div class="flow-arrow">‚ûú</div>

                    <!-- Step 5: Verdict -->
                    <div class="flow-node final-node">
                        <div class="node-icon">üõ°Ô∏è</div>
                        <div class="node-title">VERDICT</div>
                        <div class="node-subtitle">Safe / Suspicious / Malicious</div>
                    </div>

                </div>
            </div>

            <!-- Detailed Layers -->
            <div class="layers-container"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 60px;">

                <!-- Layer 1 -->
                <div class="titan-card">
                    <h3 style="color: var(--neon-blue);">LAYER 1: STATIC ANALYSIS</h3>
                    <p class="layer-subtitle">Speed: < 50ms // The DNA Check</p>
                            <ul class="tech-list">
                                <li><strong>Syntax Analysis:</strong> Regex pattern matching for IP addresses, double
                                    extensions, and obfuscation.</li>
                                <li><strong>Homograph Ops:</strong> Detection of IDN spoofing (e.g., Cyrillic 'a' vs
                                    Latin 'a').
                                </li>
                                <li><strong>Heuristics:</strong> Entropy calculation and fast-filter rule matching.</li>
                            </ul>
                </div>

                <!-- Layer 2 -->
                <div class="titan-card">
                    <h3 style="color: var(--neon-magenta);">LAYER 2: REPUTATION & NET</h3>
                    <p class="layer-subtitle">Speed: < 300ms // The Shadow Check</p>
                            <ul class="tech-list">
                                <li><strong>Domain Age:</strong> Checks for newly registered domains (often malicious).
                                </li>
                                <li><strong>SSL Forensics:</strong> Validates certificate chains and issuer reputation.
                                </li>
                                <li><strong>Threat Feeds:</strong> Cross-references against known blocklists and
                                    databases.</li>
                            </ul>
                </div>

                <!-- Layer 3 -->
                <div class="titan-card" style="border-color: var(--neon-gold);">
                    <h3 style="color: var(--neon-gold);">LAYER 3: AI & BEHAVIORAL</h3>
                    <p class="layer-subtitle">Speed: ~1s // The Brain</p>
                    <ul class="tech-list">
                        <li><strong>Content RAG:</strong> Extracts text to query vector databases for context (e.g.,
                            "Login" +
                            "Bank").</li>
                        <li><strong>Visual AI:</strong> Computer Vision to detect brand logos on unauthorized sites.
                        </li>
                        <li><strong>ML Model:</strong> Neural network trained on millions of phishing samples.</li>
                    </ul>
                </div>
            </div>

            <!-- AI Deep Dive Section -->
            <div class="titan-panel" style="padding: 40px;">
                <h2
                    style="color: var(--neon-gold); margin-bottom: 30px; border-bottom: 1px solid rgba(255, 215, 0, 0.2); padding-bottom: 10px;">
                    // THE AI CORE EXPLAINED
                </h2>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
                    <div>
                        <h3 style="color: var(--text-primary); margin-bottom: 15px;">Machine Learning Classifiers</h3>
                        <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px;">
                            Our system employs a dedicated machine learning pipeline (`ml_model.py`) that uses a Random
                            Forest
                            classifier. It extracts over 20 distinct features from a URL, including:
                        </p>
                        <ul class="tech-list">
                            <li>Ratio of digits to letters</li>
                            <li>Presence of security-sensitive words</li>
                            <li>Subdomain depth and path length</li>
                            <li>Character entropy distribution</li>
                        </ul>
                        <p style="color: var(--text-secondary); line-height: 1.6; margin-top: 20px;">
                            This model provides a probabilistic score (0-100%) that acts as a decisive weighted factor
                            in the
                            final verdict.
                        </p>
                    </div>

                    <div
                        style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 8px; border: 1px solid var(--border-color);">
                        <pre
                            style="color: var(--neon-gold); font-family: 'JetBrains Mono', monospace; font-size: 0.9em; overflow-x: auto;">
# AI SCORING LOGIC
def derive_verdict(ml_confidence, prediction):
    if ml_confidence > 0.85:
        # High confidence overrides heuristics
        return prediction
    else:
        # Lower confidence acts as advisor
        return weighted_average(heuristics, ml_score)
                </pre>
                    </div>
                </div>

                <div style="margin-top: 40px;">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">Retrieval-Augmented Generation (RAG)
                    </h3>
                    <p style="color: var(--text-secondary); line-height: 1.6;">
                        The system analyzes page content using RAG principles. It extracts visible text (e.g., "Welcome
                        to
                        PayPal Update") and queries an internal knowledge base of legitimate domains. If the content
                        claims to
                        be "PayPal" but the domain is "paypal-security-check.com", the semantic mismatch triggers a
                        high-risk
                        alert that pure code analysis might miss.
                    </p>
                </div>
            </div>

        </div>

        <style>
            /* Custom Flowchart CSS */
            .flow-container {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 15px;
                min-width: 900px;
                /* Ensure lateral flow doesn't crush */
            }

            .flow-node {
                background: rgba(255, 255, 255, 0.03);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 15px;
                text-align: center;
                min-width: 120px;
                transition: all 0.3s ease;
                position: relative;
            }

            .flow-node:hover {
                transform: translateY(-5px);
                box-shadow: 0 0 15px rgba(0, 255, 249, 0.2);
                border-color: var(--neon-cyan);
            }

            .input-node {
                border-left: 3px solid #fff;
            }

            .orch-node {
                border-left: 3px solid var(--neon-cyan);
            }

            .agg-node {
                border-left: 3px solid var(--neon-magenta);
            }

            .final-node {
                border-left: 3px solid var(--neon-red);
                background: rgba(255, 0, 0, 0.05);
            }

            .node-icon {
                font-size: 24px;
                margin-bottom: 5px;
            }

            .node-title {
                font-weight: bold;
                font-size: 0.9em;
                color: var(--text-primary);
            }

            .node-subtitle {
                font-size: 0.7em;
                color: var(--text-muted);
            }

            .flow-arrow {
                color: var(--text-muted);
                font-size: 1.5em;
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0% {
                    opacity: 0.3;
                }

                50% {
                    opacity: 1;
                    text-shadow: 0 0 5px var(--neon-cyan);
                }

                100% {
                    opacity: 0.3;
                }
            }

            .layers-wrapper {
                display: flex;
                flex-direction: column;
                gap: 10px;
                flex-grow: 1;
            }

            .layer-box {
                background: rgba(0, 0, 0, 0.2);
                border: 1px dashed var(--border-color);
                padding: 10px;
                border-radius: 6px;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .l1 {
                border-color: var(--neon-blue);
            }

            .l2 {
                border-color: var(--neon-magenta);
            }

            .l3 {
                border-color: var(--neon-gold);
            }

            .layer-header {
                font-size: 0.7em;
                font-weight: bold;
                writing-mode: vertical-lr;
                transform: rotate(180deg);
                padding: 5px 0;
                opacity: 0.8;
            }

            .l1 .layer-header {
                color: var(--neon-blue);
            }

            .l2 .layer-header {
                color: var(--neon-magenta);
            }

            .l3 .layer-header {
                color: var(--neon-gold);
            }

            .sub-nodes {
                display: flex;
                gap: 8px;
                flex-grow: 1;
                justify-content: center;
                padding: 0 10px;
            }

            .mini-node {
                background: rgba(255, 255, 255, 0.05);
                padding: 5px 10px;
                border-radius: 4px;
                font-size: 0.75em;
                border: 1px solid transparent;
            }

            .l1 .mini-node {
                border-bottom: 1px solid var(--neon-blue);
            }

            .l2 .mini-node {
                border-bottom: 1px solid var(--neon-magenta);
            }

            .l3 .mini-node {
                border-bottom: 1px solid var(--neon-gold);
            }

            .layer-metric {
                font-family: var(--font-mono);
                font-size: 0.7em;
                color: var(--text-muted);
                width: 50px;
                text-align: right;
            }

            /* Existing Page Styles */
            .titan-card {
                background: rgba(20, 20, 30, 0.6);
                border: 1px solid var(--border-color);
                padding: 25px;
                border-radius: 8px;
                transition: transform 0.3s, box-shadow 0.3s;
            }

            .titan-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
                border-color: var(--neon-cyan);
            }

            .layer-subtitle {
                color: var(--text-muted);
                font-family: var(--font-mono);
                font-size: 0.85em;
                margin-bottom: 20px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                padding-bottom: 10px;
            }

            .tech-list {
                list-style: none;
                padding: 0;
            }

            .tech-list li {
                margin-bottom: 15px;
                color: var(--text-secondary);
                position: relative;
                padding-left: 20px;
                line-height: 1.5;
            }

            .tech-list li::before {
                content: "‚ñπ";
                position: absolute;
                left: 0;
                color: var(--neon-cyan);
            }
        </style>
        {% endblock %}