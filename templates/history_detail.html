{% extends "base.html" %}

{% block content %}
<div class="container">
    <div style="margin-bottom: 30px;">
        <a href="{{ url_for('history') }}"
            style="color: var(--text-secondary); text-decoration: none; display: flex; align-items: center; gap: 5px; font-size: 14px;">
            <span>&larr;</span> Back to Archive
        </a>
    </div>

    <div class="verdict-card {{ entry.classification.lower() }}" style="margin-top: 0;">
        <div
            style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 20px;">
            <div style="flex: 1; text-align: left;">
                <span class="verdict-badge">{{ entry.verdict }}</span>
                <h1 style="font-size: 24px; word-break: break-all; margin-bottom: 10px;">{{ entry.url }}</h1>
                <p style="color: var(--text-muted); font-family: 'JetBrains Mono', monospace; font-size: 12px;">ID: {{
                    entry.id }} • {{ entry.timestamp[:19].replace('T', ' ') }}</p>
            </div>
            <div style="text-align: right;">
                <div class="{{ 'text-safe' if entry.score < 50 else 'text-danger' }}"
                    style="font-size: 48px; font-weight: 900; line-height: 1;">
                    {{ entry.score }}</div>
                <div style="font-size: 12px; color: var(--text-muted); letter-spacing: 1px;">RISK SCORE</div>
            </div>
        </div>

        <div class="stats-grid"
            style="margin-top: 40px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
            <div class="stat-card">
                <div class="stat-label">Classification</div>
                <div class="stat-value" style="font-size: 18px;">{{ entry.classification }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Confidence</div>
                <div class="stat-value" style="font-size: 18px;">{{ entry.confidence }}%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Analysis Type</div>
                <div class="stat-value" style="font-size: 18px;">{{ 'Combined' if entry.breakdown else 'Standard' }}
                </div>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-top: 30px;">
        <!-- Detailed Breakdown -->
        <div style="background: var(--bg-panel); border-radius: 12px; border: var(--glass-border); padding: 30px;">
            <h3 style="margin-bottom: 20px; color: var(--text-primary);">Risk Factors</h3>

            {% if entry.risk_summary %}
            {% for category, data in entry.risk_summary.items() %}
            <div style="margin-bottom: 25px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span
                        style="color: var(--text-secondary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">{{
                        category }}</span>
                    <span class="{{ 'text-danger' if data.score > 20 }}"
                        style="color: var(--text-muted); font-weight: 700;">{{
                        data.score }}</span>
                </div>
                <!-- Bar -->
                <div style="height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden;">
                    <div class="{{ 'bg-danger' if data.score > 20 else 'bg-safe' }}"
                        style="--data-width: {{ [data.score|int, 5] | max }}%; width: var(--data-width); height: 100%;">
                    </div>
                </div>
                <!-- Details -->
                {% if data.details %}
                <div style="margin-top: 10px; padding-left: 10px; border-left: 2px solid rgba(255,255,255,0.1);">
                    {% for detail in data.details %}
                    <div style="margin-bottom: 5px; font-size: 13px; color: var(--text-secondary);">
                        <span style="color: var(--neon-red);">•</span> <strong>{{ detail.name }}</strong>: {{
                        detail.explanation }}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
            {% else %}
            <!-- Legacy Support if risk_summary missing -->
            <p style="color: var(--text-muted);">No granular details available for this record.</p>
            {% endif %}
        </div>

        <!-- Sidebar Actions -->
        <div>
            <div
                style="background: var(--bg-panel); border-radius: 12px; border: var(--glass-border); padding: 30px; border-top: 4px solid var(--neon-red);">
                <h3 style="margin-bottom: 15px; color: var(--neon-red);">Danger Zone</h3>
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 20px;">Permanently remove this
                    intelligence record from the database.</p>
                <form method="POST" action="{{ url_for('delete_history_entry', entry_id=entry.id) }}"
                    onsubmit="return confirm('Delete record?');">
                    <button type="submit"
                        style="width: 100%; padding: 12px; background: transparent; border: 1px solid var(--neon-red); color: var(--neon-red); border-radius: 8px; font-weight: 700; cursor: pointer;">DELETE
                        RECORD</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}